<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>脚本 on 元视角</title><link>http://example.org/tags/%E8%84%9A%E6%9C%AC/</link><description>Recent content in 脚本 on 元视角</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Mon, 05 Feb 2018 16:48:39 +0000</lastBuildDate><atom:link href="http://example.org/tags/%E8%84%9A%E6%9C%AC/index.xml" rel="self" type="application/rss+xml"/><item><title>基于 Python 实现 Windows 下壁纸切换功能</title><link>http://example.org/posts/2822230423/</link><pubDate>Mon, 05 Feb 2018 16:48:39 +0000</pubDate><guid>http://example.org/posts/2822230423/</guid><description>在过去一年多的时间里，我尝试改变博客的写作风格，努力让自己不再写教程类文章，即使在这个过程中，不断地面临着写作内容枯竭的痛苦。因为我渐渐地意识到，告诉别人如何去做一件事情，始终停留在&amp;quot;术&amp;quot;的层面，而比这个更为重要的是，告诉别人为什么要这样做，这样就可以过渡到&amp;quot;道&amp;quot;的层面。古人云：形而上者谓之道，形而下者谓之器。我们常常希望通过量变来产生质变，可是如果在这个过程中不能及时反思和总结，我们认为的努力或许仅仅是重复的劳作而已。如你所见，在这篇文章里，我们将通过 Python 和 Windows 注册表实现壁纸切换功能，主要涉及到的 Python 中的 requests、pyinstaller 这两个模块的使用，希望大家喜欢。
故事缘由 人们常常相信事出有因，可这世界上有些事情，哪里会有什么原因啊，比如喜欢与不喜欢。做这样一个小功能的初衷，起源于我对桌面壁纸的挑剔。作为一个不完全的强迫症患者，我需要花费大量时间去挑选一张壁纸，丝毫不亚于在网上挑选一件喜欢的商品。我注意到知乎上有这样的话题：有哪些无版权图片网站值得推荐？，因此对于桌面壁纸的筛选，我渐渐地开始摆脱对搜索引擎的依赖，我个人比较喜欢Pexels和Unsplash这两个网站，所以我想到了从这两个网站抓取图片来设置 Windows 壁纸的方案。市面上类似的商业软件有百度壁纸、搜狗壁纸等，可这些软件都不纯粹，或多或少地掺杂了额外功能，个中缘由想来大家都是知道的。联想到微信最新版本的更新，&amp;ldquo;发现&amp;quot;页面支持所有项目的隐藏，甚至是盟友京东的电商入口和腾讯最赚钱的游戏入口，这让我开始正视腾讯这家公司，我收回曾经因为抄袭对腾讯产生的不满，腾讯是一家值得尊重的互联网公司。做一个纯粹的应用程序，这就是我的初心。
设计实现 好了，现在我们考虑如何来实现这个功能，我们的思路是从Unsplash这个网站抓取图片，并将其存储在指定路径，然后通过 Windows API 完成壁纸的设置。Python 脚本会通过 pyinstaller 模块打包成可执行文件，我们通过修改注册表的方式，在右键菜单内加入切换壁纸的选项，这样我们可以直接通过右键菜单实现壁纸切换功能。在编写脚本的时候，起初想到的是抓包这样的常规思路，因为请求过程相对复杂而失败，后来意外地发现官方提供了 API 接口。事实上Pexels和Unsplash都提供了 API 接口，通过调用这些 API 接口，我们的探索进行得非常顺利，下面是具体脚本实现：
# Query Images searchURL = &amp;#39;https://unsplash.com/napi/search?client_id=%s&amp;amp;query=%s&amp;amp;page=1&amp;#39; client_id = &amp;#39;fa60305aa82e74134cabc7093ef54c8e2c370c47e73152f72371c828daedfcd7&amp;#39; categories = [&amp;#39;nature&amp;#39;,&amp;#39;flowers&amp;#39;,&amp;#39;wallpaper&amp;#39;,&amp;#39;landscape&amp;#39;,&amp;#39;sky&amp;#39;] searchURL = searchURL % (client_id,random.choice(categories)) response = requests.get(searchURL) print(u&amp;#39;正在从Unsplash上搜索图片...&amp;#39;) # Parse Images data = json.loads(response.text) results = data[&amp;#39;photos&amp;#39;][&amp;#39;results&amp;#39;] print(u&amp;#39;已为您检索到图片共%s张&amp;#39; % str(len(results))) results = list(filter(lambda x:float(x[&amp;#39;width&amp;#39;])/x[&amp;#39;height&amp;#39;] &amp;gt;=1.33,results)) result = random.choice(results) resultId = str(result[&amp;#39;id&amp;#39;]) resultURL = result[&amp;#39;urls&amp;#39;][&amp;#39;regular&amp;#39;] # Download Images print(u&amp;#39;正在为您下载图片:%s.</description></item></channel></rss>