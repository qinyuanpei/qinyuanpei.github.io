<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>WMI on 元视角</title><link>http://example.org/tags/wmi/</link><description>Recent content in WMI on 元视角</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Wed, 18 Oct 2023 12:30:47 +0000</lastBuildDate><atom:link href="http://example.org/tags/wmi/index.xml" rel="self" type="application/rss+xml"/><item><title>C# 使用 LibUsbDotNet 实现 USB 设备检测</title><link>http://example.org/posts/csharp-uses-libusbdotnet-to-implement-usb-device-detection/</link><pubDate>Wed, 18 Oct 2023 12:30:47 +0000</pubDate><guid>http://example.org/posts/csharp-uses-libusbdotnet-to-implement-usb-device-detection/</guid><description>国庆节回来后的工作内容，基本都在围绕着各种各样的硬件展开，这无疑让本就漫长的 “七天班” ，更加平添了三分枯燥，我甚至在不知不觉中学会了，如何给打印机装上不同尺寸的纸张。华为的 Mate 60 发布以后，人群中此起彼伏地传出 “遥遥领先” 的声音，大概人类总是热衷于评价那些不甚了解的事物。这个现象到了工作中就会变成，总有某些人觉得某件事情特别简单。其实。一切你认为“简单”的东西，背后一定有无数的人们上下求索、苦心孤诣，就像计算机从早期的埃尼阿克(ENIAC)发展到今天的智能手机，你能使用它并不代表它就“简单”，人还是应该对为止的领域保持敬畏和谦逊。回到这篇文章，今天我想和大家聊一聊，我为了解决那些“简单”的问题而做出的尝试。本期的故事主角是我们最熟悉不过的 USB 设备，有道是 “千古兴亡多少事”，且听我娓娓道来。
故事是这样的，基于某些不可抗因素上的考虑，博主需要在程序中集成某厂商的硬件。我猜测，人们觉得这件事情“简单”，或许是看到这个设备有一条 USB 连接线，因为在人们的固有印象中，只要把它接到电脑上就可以正常工作了。事实的确如此，因为你只要考虑串口(SerialPort)、USB 以及这两者间的相互转换即可。当然，这世上的事情圆满者少，遗憾者多，博主在使用过程中发现，厂商的提供的 SDK 存在 Bug，当设备从电脑上拔出后，其 SDK 的初始化函数依然正常返回了，这意味着我们无法在使用设备前“正确”地检测出硬件状态。考虑厂商愿不愿意修复这个 Bug 还是个未知数，博主不得不尝试另辟蹊径。
Windows 中的设备与打印机相信这张图片大家都见过无数次啦，在这里你可以看到操作系统接入的各种设备。以鼠标为例，通过下面这个对话框，我们可以获得这个设备的各种属性信息：
查阅鼠标的硬件信息在各种属性信息中，硬件 Id 是最为关键的一组信息，我们可以看到鼠标这个设备的 VID 为 0000，PID 为 3825。其中，VID 是指 Vender ID，即：供应商识别码；PID 是指 Product ID，即：产品识别码。事实上，所有的 USB 设备都有 VID 和 PID，VID 由供应商向 USB-IF 申请获得，而 PID 则由供应商自行指定，计算机正是 VID、PID 以及设备的版本号来决定加载或者安装相应的驱动程序。因此，如果想要判断计算机是否连接了某个 USB 设备，我们可以使用下面的方案：
bool HasUsbDevice(string vid, string pid) { var query = $&amp;#34;SELECT * FROM Win32_PnPEntity WHERE DeviceID LIKE &amp;#39;USB%VID_{vid}&amp;amp;PID_{pid}%&amp;#39;&amp;#34;; var searcher = new ManagementObjectSearcher(query); var devices = searcher.</description></item></channel></rss>