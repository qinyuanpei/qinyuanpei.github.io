function VisitorCounter(){this.config={appId:"",appKey:"",region:"",domain:"",site_uv:0,site_pv:0,collectIP:!0,collectUA:!0},this.init=function(e){var t=this;t.mergeConfig(e);var n=location.href.split("//")[1];n=n.substring(0,n.indexOf("/"));var i=document.title,r={page_url:n};this.queryClass("VisitorCounter",r).then(function(e){if(0==e.results.length){var r={};r.page_pv=site_pv,r.page_uv=site_uv,r.page_url=n,r.page_title=i,t.createClass("VisitorCounter",r).then(function(e){console.log("init PV/UV of "+n+"success")})}}),this.injectScript(),this.pagePV(),this.pageUV(),this.sitePV(),this.siteUV()},this.sitePV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0],n=document.getElementById("lc_counter_value_site_pv");null!=n&&(n.innerText=t.page_pv)}})},this.siteUV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/")));var t={page_url:e};this.queryClass("VisitorCounter",t).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var n=document.getElementById("lc_counter_value_site_uv");null!=n&&(n.innerText=t.page_uv)}})},this.pagePV=function(){var e=location.href.replace(location.search,""),t=document.title,n={page_url:e},i=this;this.queryClass("VisitorCounter",n).then(function(n){if(n.results.length>0){var r=n.results[0];(o={}).objectId=r.objectId,o.page_pv=r.page_pv,o.page_pv+=1,i.updateClass("VisitorCounter",o).then(function(e){console.log(e)}),null!=(s=document.getElementById("lc_counter_value_page_pv"))&&(s.innerText=o.page_pv)}else{var o,s;(o={}).page_title=t,o.page_url=e,o.page_pv=1,o.page_uv=1,i.createClass("VisitorCounter",o),null!=(s=document.getElementById("lc_counter_value_page_pv"))&&(s.innerText=o.page_pv)}})},this.pageUV=function(){var e=location.href.replace(location.search,""),t=document.title,n=JSON.parse(localStorage.getItem("ipInfo")),i={page_url:e,visitor_ip:n.ip},r=this;r.queryClass("VisitorRecord",i).then(function(n){if(0==n.results.length){newRecord={},newRecord.page_url=e,newRecord.page_title=t;var i=JSON.parse(localStorage.getItem("ipInfo"));newRecord.visitor_ip=i.ip,newRecord.visitor_geo=i;var o=new UAParser;newRecord.visitor_ua=o.getResult(),console.log(newRecord.visitor_ua),r.createClass("VisitorRecord",newRecord)}}).then(function(e){console.log(e)}),i={page_url:e},r.queryClass("VisitorCounter",i).then(function(e){if(e.results.length>0){var t=e.results[0];console.log(t);var n=document.getElementById("lc_counter_value_page_uv");null!=n&&(n.innerText=t.page_uv)}})},this.queryClass=function(e,t){var n=this.buildHeaders(),i=this.config.baseUrl+"/1.1/classes/"+e+"?where="+JSON.stringify(t);return fetch(i,{mode:"cors",method:"GET",headers:n}).then(function(e){return e.json()})},this.createClass=function(e,t){var n=this.buildHeaders(),i=this.config.baseUrl+"/1.1/classes/"+e;return fetch(i,{mode:"cors",method:"POST",headers:n,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.updateClass=function(e,t){var n=this.buildHeaders(),i=this.config.baseUrl+"/1.1/classes/"+e+"/"+t.objectId;return fetch(i,{mode:"cors",method:"PUT",headers:n,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.injectScript=function(){var e=document.getElementsByTagName("head")[0];for(script of["https://api.ip.sb/geoip?callback=handleIP","https://blog.yuanpei.me/assets/scripts/ua-parser.min.js"]){var t=document.createElement("script");t.type="text/javascript",t.src=script,e.appendChild(t)}window.handleIP=function(e){this.localStorage.clear(),this.localStorage.setItem("ipInfo",this.JSON.stringify(e))}},this.mergeConfig=function(e){for(key in e=e||{})void 0!==e[key]&&(this.config[key]=e[key]);if(""==this.config.appId||""==this.config.appKey)throw"请输入当前应用的AppId和AppKey";if(""==this.config.domain){if(""!=this.config.region)switch(this.config.region){case"华东":case"华北":case"国际":this.config.baseUrl="https://"+this.config.appId.substring(0,8)+".api.lncld.net"}this.config.baseUrl="https://"+this.config.appId.substring(0,8)+".api.lncld.net"}else this.config.baseUrl=this.config.domain},this.buildHeaders=function(){var e=(new Date).getTime(),t=(new Utils).md5(e+this.config.appKey);return{"X-LC-Id":this.config.appId,"X-LC-Sign":t+","+e,"Content-Type":"application/json"}}}function Utils(){this.md5=function(e){var t=function(e,t){return e<<t|e>>>32-t},n=function(e,t){var n,i,r,o,s;return r=2147483648&e,o=2147483648&t,s=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(i=1073741824&t)?2147483648^s^r^o:n|i?1073741824&s?3221225472^s^r^o:1073741824^s^r^o:s^r^o},i=function(e,i,r,o,s,a,c){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(i,r,o),s),c)),n(t(e,a),i)},r=function(e,i,r,o,s,a,c){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(i,r,o),s),c)),n(t(e,a),i)},o=function(e,i,r,o,s,a,c){return e=n(e,n(n(function(e,t,n){return e^t^n}(i,r,o),s),c)),n(t(e,a),i)},s=function(e,i,r,o,s,a,c){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(i,r,o),s),c)),n(t(e,a),i)},a=function(e){for(var t,n=e.length,i=n+8,r=16*((i-i%64)/64+1),o=Array(r-1),s=0,a=0;a<n;)s=a%4*8,o[t=(a-a%4)/4]=o[t]|e.charCodeAt(a)<<s,a++;return s=a%4*8,o[t=(a-a%4)/4]=o[t]|128<<s,o[r-2]=n<<3,o[r-1]=n>>>29,o},c=function(e){var t,n="",i="";for(t=0;t<=3;t++)n+=(i="0"+(e>>>8*t&255).toString(16)).substr(i.length-2,2);return n},u=function(e){e=e.toString().replace(/\x0d\x0a/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t};return function(e){var t,l,g,h,p,f,d,v,_,m=Array();for(e=u(e),m=a(e),f=1732584193,d=4023233417,v=2562383102,_=271733878,t=0;t<m.length;t+=16)l=f,g=d,h=v,p=_,f=i(f,d,v,_,m[t+0],7,3614090360),_=i(_,f,d,v,m[t+1],12,3905402710),v=i(v,_,f,d,m[t+2],17,606105819),d=i(d,v,_,f,m[t+3],22,3250441966),f=i(f,d,v,_,m[t+4],7,4118548399),_=i(_,f,d,v,m[t+5],12,1200080426),v=i(v,_,f,d,m[t+6],17,2821735955),d=i(d,v,_,f,m[t+7],22,4249261313),f=i(f,d,v,_,m[t+8],7,1770035416),_=i(_,f,d,v,m[t+9],12,2336552879),v=i(v,_,f,d,m[t+10],17,4294925233),d=i(d,v,_,f,m[t+11],22,2304563134),f=i(f,d,v,_,m[t+12],7,1804603682),_=i(_,f,d,v,m[t+13],12,4254626195),v=i(v,_,f,d,m[t+14],17,2792965006),d=i(d,v,_,f,m[t+15],22,1236535329),f=r(f,d,v,_,m[t+1],5,4129170786),_=r(_,f,d,v,m[t+6],9,3225465664),v=r(v,_,f,d,m[t+11],14,643717713),d=r(d,v,_,f,m[t+0],20,3921069994),f=r(f,d,v,_,m[t+5],5,3593408605),_=r(_,f,d,v,m[t+10],9,38016083),v=r(v,_,f,d,m[t+15],14,3634488961),d=r(d,v,_,f,m[t+4],20,3889429448),f=r(f,d,v,_,m[t+9],5,568446438),_=r(_,f,d,v,m[t+14],9,3275163606),v=r(v,_,f,d,m[t+3],14,4107603335),d=r(d,v,_,f,m[t+8],20,1163531501),f=r(f,d,v,_,m[t+13],5,2850285829),_=r(_,f,d,v,m[t+2],9,4243563512),v=r(v,_,f,d,m[t+7],14,1735328473),d=r(d,v,_,f,m[t+12],20,2368359562),f=o(f,d,v,_,m[t+5],4,4294588738),_=o(_,f,d,v,m[t+8],11,2272392833),v=o(v,_,f,d,m[t+11],16,1839030562),d=o(d,v,_,f,m[t+14],23,4259657740),f=o(f,d,v,_,m[t+1],4,2763975236),_=o(_,f,d,v,m[t+4],11,1272893353),v=o(v,_,f,d,m[t+7],16,4139469664),d=o(d,v,_,f,m[t+10],23,3200236656),f=o(f,d,v,_,m[t+13],4,681279174),_=o(_,f,d,v,m[t+0],11,3936430074),v=o(v,_,f,d,m[t+3],16,3572445317),d=o(d,v,_,f,m[t+6],23,76029189),f=o(f,d,v,_,m[t+9],4,3654602809),_=o(_,f,d,v,m[t+12],11,3873151461),v=o(v,_,f,d,m[t+15],16,530742520),d=o(d,v,_,f,m[t+2],23,3299628645),f=s(f,d,v,_,m[t+0],6,4096336452),_=s(_,f,d,v,m[t+7],10,1126891415),v=s(v,_,f,d,m[t+14],15,2878612391),d=s(d,v,_,f,m[t+5],21,4237533241),f=s(f,d,v,_,m[t+12],6,1700485571),_=s(_,f,d,v,m[t+3],10,2399980690),v=s(v,_,f,d,m[t+10],15,4293915773),d=s(d,v,_,f,m[t+1],21,2240044497),f=s(f,d,v,_,m[t+8],6,1873313359),_=s(_,f,d,v,m[t+15],10,4264355552),v=s(v,_,f,d,m[t+6],15,2734768916),d=s(d,v,_,f,m[t+13],21,1309151649),f=s(f,d,v,_,m[t+4],6,4149444226),_=s(_,f,d,v,m[t+11],10,3174756917),v=s(v,_,f,d,m[t+2],15,718787259),d=s(d,v,_,f,m[t+9],21,3951481745),f=n(f,l),d=n(d,g),v=n(v,h),_=n(_,p);return(c(f)+c(d)+c(v)+c(_)).toLowerCase()}(e)}}