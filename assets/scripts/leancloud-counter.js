function VisitorCounter(){this.config={appId:"",appKey:"",region:"",domain:"",site_uv:0,site_pv:0,collectIP:!0,collectUA:!0},this.init=function(e){var t=this;t.mergeConfig(e);var e=location.href,n=(n=e.split("//")[1]).substring(0,n.indexOf("/")),i=document.title,e={page_url:n};this.queryClass("VisitorCounter",e).then(function(e){0==e.results.length&&((e={}).page_pv=site_pv,e.page_uv=site_uv,e.page_url=n,e.page_title=i,t.createClass("VisitorCounter",e).then(function(e){console.log("init PV/UV of "+n+"success")}))}),this.injectScript(),this.pagePV(),this.pageUV(),this.sitePV(),this.siteUV()},this.sitePV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/"))),this.queryClass("VisitorCounter",{page_url:e}).then(function(e){var t;0<e.results.length&&(t=e.results[0],null!=(e=document.getElementById("lc_counter_value_site_pv"))&&(e.innerText=t.page_pv))})},this.siteUV=function(){var e=location.href;-1!=e.indexOf("//")&&(e=(e=e.split("//")[1]).substring(0,e.indexOf("/"))),this.queryClass("VisitorCounter",{page_url:e}).then(function(e){var t;0<e.results.length&&(t=e.results[0],console.log(t),null!=(e=document.getElementById("lc_counter_value_site_uv"))&&(e.innerText=t.page_uv))})},this.pagePV=function(){var i=location.href.replace(location.search,""),r=document.title,s=this;this.queryClass("VisitorCounter",{page_url:i}).then(function(e){var t,n;0<e.results.length?(n=e.results[0],(t={}).objectId=n.objectId,t.page_pv=n.page_pv,t.page_pv+=1,s.updateClass("VisitorCounter",t).then(function(e){console.log(e)})):((t={}).page_title=r,t.page_url=i,t.page_pv=1,t.page_uv=1,s.createClass("VisitorCounter",t)),null!=(n=document.getElementById("lc_counter_value_page_pv"))&&(n.innerText=t.page_pv)})},this.pageUV=function(){var t=location.href.replace(location.search,""),n=document.title,e=JSON.parse(localStorage.getItem("ipInfo")),e={page_url:t,visitor_ip:e.ip},i=this;i.queryClass("VisitorRecord",e).then(function(e){0==e.results.length&&(newRecord={},newRecord.page_url=t,newRecord.page_title=n,e=JSON.parse(localStorage.getItem("ipInfo")),newRecord.visitor_ip=e.ip,newRecord.visitor_geo=e,e=new UAParser,newRecord.visitor_ua=e.getResult(),console.log(newRecord.visitor_ua),i.createClass("VisitorRecord",newRecord))}).then(function(e){console.log(e)}),i.queryClass("VisitorCounter",{page_url:t}).then(function(e){var t;0<e.results.length&&(t=e.results[0],console.log(t),null!=(e=document.getElementById("lc_counter_value_page_uv"))&&(e.innerText=t.page_uv))})},this.queryClass=function(e,t){var n=this.buildHeaders(),t=this.config.baseUrl+"/1.1/classes/"+e+"?where="+JSON.stringify(t);return fetch(t,{mode:"cors",method:"GET",headers:n}).then(function(e){return e.json()})},this.createClass=function(e,t){var n=this.buildHeaders(),e=this.config.baseUrl+"/1.1/classes/"+e;return fetch(e,{mode:"cors",method:"POST",headers:n,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.updateClass=function(e,t){var n=this.buildHeaders(),e=this.config.baseUrl+"/1.1/classes/"+e+"/"+t.objectId;return fetch(e,{mode:"cors",method:"PUT",headers:n,body:JSON.stringify(t)}).then(function(e){return e.json()})},this.injectScript=function(){var e=document.getElementsByTagName("head")[0];for(script of["https://api.ip.sb/geoip?callback=handleIP","https://cdn.jsdelivr.net/gh/qinyuanpei/blog.yuanpei.me@master/assets/scripts/ua-parser.min.js"]){var t=document.createElement("script");t.type="text/javascript",t.src=script,e.appendChild(t)}window.handleIP=function(e){this.localStorage.clear(),this.localStorage.setItem("ipInfo",this.JSON.stringify(e))}},this.mergeConfig=function(e){for(key in e=e||{})void 0!==e[key]&&(this.config[key]=e[key]);if(""==this.config.appId||""==this.config.appKey)throw"请输入当前应用的AppId和AppKey";if(""==this.config.domain){if(""!=this.config.region)switch(this.config.region){case"华东":case"华北":case"国际":this.config.baseUrl="https://"+this.config.appId.substring(0,8)+".api.lncld.net"}this.config.baseUrl="https://"+this.config.appId.substring(0,8)+".api.lncld.net"}else this.config.baseUrl=this.config.domain},this.buildHeaders=function(){var e=(new Date).getTime(),t=(new Utils).md5(e+this.config.appKey);return{"X-LC-Id":this.config.appId,"X-LC-Sign":t+","+e,"Content-Type":"application/json"}}}function Utils(){this.md5=function(e){function a(e,t){return e<<t|e>>>32-t}var g=function(e,t){var n=2147483648&e,i=2147483648&t,r=1073741824&e,s=1073741824&t,t=(1073741823&e)+(1073741823&t);return r&s?2147483648^t^n^i:r|s?1073741824&t?3221225472^t^n^i:1073741824^t^n^i:t^n^i},h=function(e,t,n,i,r,s,o){return e=g(e,g(g(t&n|~t&i,r),o)),g(a(e,s),t)},p=function(e,t,n,i,r,s,o){return e=g(e,g(g(t&i|n&~i,r),o)),g(a(e,s),t)},f=function(e,t,n,i,r,s,o){return e=g(e,g(g(t^n^i,r),o)),g(a(e,s),t)},d=function(e,t,n,i,r,s,o){return e=g(e,g(g(n^(t|~i),r),o)),g(a(e,s),t)},v=function(e){for(var t,n=e.length,i=n+8,i=16*(1+(i-i%64)/64),r=Array(i-1),s=0,o=0;o<n;)s=o%4*8,r[t=(o-o%4)/4]=r[t]|e.charCodeAt(o)<<s,o++;return r[t=(o-o%4)/4]=r[t]|128<<(s=o%4*8),r[i-2]=n<<3,r[i-1]=n>>>29,r},_=function(e){for(var t="",n="",i=0;i<=3;i++)t+=(n="0"+(e>>>8*i&255).toString(16)).substr(n.length-2,2);return t},m=function(e){e=e.toString().replace(/\x0d\x0a/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t};return function(e){var t,n,i,r,s,o,a,c,u,l;Array();for(e=m(e),t=v(e),a=1732584193,c=4023233417,u=2562383102,l=271733878,n=0;n<t.length;n+=16)a=h(i=a,r=c,s=u,o=l,t[n+0],7,3614090360),l=h(l,a,c,u,t[n+1],12,3905402710),u=h(u,l,a,c,t[n+2],17,606105819),c=h(c,u,l,a,t[n+3],22,3250441966),a=h(a,c,u,l,t[n+4],7,4118548399),l=h(l,a,c,u,t[n+5],12,1200080426),u=h(u,l,a,c,t[n+6],17,2821735955),c=h(c,u,l,a,t[n+7],22,4249261313),a=h(a,c,u,l,t[n+8],7,1770035416),l=h(l,a,c,u,t[n+9],12,2336552879),u=h(u,l,a,c,t[n+10],17,4294925233),c=h(c,u,l,a,t[n+11],22,2304563134),a=h(a,c,u,l,t[n+12],7,1804603682),l=h(l,a,c,u,t[n+13],12,4254626195),u=h(u,l,a,c,t[n+14],17,2792965006),c=h(c,u,l,a,t[n+15],22,1236535329),a=p(a,c,u,l,t[n+1],5,4129170786),l=p(l,a,c,u,t[n+6],9,3225465664),u=p(u,l,a,c,t[n+11],14,643717713),c=p(c,u,l,a,t[n+0],20,3921069994),a=p(a,c,u,l,t[n+5],5,3593408605),l=p(l,a,c,u,t[n+10],9,38016083),u=p(u,l,a,c,t[n+15],14,3634488961),c=p(c,u,l,a,t[n+4],20,3889429448),a=p(a,c,u,l,t[n+9],5,568446438),l=p(l,a,c,u,t[n+14],9,3275163606),u=p(u,l,a,c,t[n+3],14,4107603335),c=p(c,u,l,a,t[n+8],20,1163531501),a=p(a,c,u,l,t[n+13],5,2850285829),l=p(l,a,c,u,t[n+2],9,4243563512),u=p(u,l,a,c,t[n+7],14,1735328473),c=p(c,u,l,a,t[n+12],20,2368359562),a=f(a,c,u,l,t[n+5],4,4294588738),l=f(l,a,c,u,t[n+8],11,2272392833),u=f(u,l,a,c,t[n+11],16,1839030562),c=f(c,u,l,a,t[n+14],23,4259657740),a=f(a,c,u,l,t[n+1],4,2763975236),l=f(l,a,c,u,t[n+4],11,1272893353),u=f(u,l,a,c,t[n+7],16,4139469664),c=f(c,u,l,a,t[n+10],23,3200236656),a=f(a,c,u,l,t[n+13],4,681279174),l=f(l,a,c,u,t[n+0],11,3936430074),u=f(u,l,a,c,t[n+3],16,3572445317),c=f(c,u,l,a,t[n+6],23,76029189),a=f(a,c,u,l,t[n+9],4,3654602809),l=f(l,a,c,u,t[n+12],11,3873151461),u=f(u,l,a,c,t[n+15],16,530742520),c=f(c,u,l,a,t[n+2],23,3299628645),a=d(a,c,u,l,t[n+0],6,4096336452),l=d(l,a,c,u,t[n+7],10,1126891415),u=d(u,l,a,c,t[n+14],15,2878612391),c=d(c,u,l,a,t[n+5],21,4237533241),a=d(a,c,u,l,t[n+12],6,1700485571),l=d(l,a,c,u,t[n+3],10,2399980690),u=d(u,l,a,c,t[n+10],15,4293915773),c=d(c,u,l,a,t[n+1],21,2240044497),a=d(a,c,u,l,t[n+8],6,1873313359),l=d(l,a,c,u,t[n+15],10,4264355552),u=d(u,l,a,c,t[n+6],15,2734768916),c=d(c,u,l,a,t[n+13],21,1309151649),a=d(a,c,u,l,t[n+4],6,4149444226),l=d(l,a,c,u,t[n+11],10,3174756917),u=d(u,l,a,c,t[n+2],15,718787259),c=d(c,u,l,a,t[n+9],21,3951481745),a=g(a,i),c=g(c,r),u=g(u,s),l=g(l,o);return(_(a)+_(c)+_(u)+_(l)).toLowerCase()}(e)}}